<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Abrox Chat — Testing-3</title>
<meta name="description" content="Abrox chat testing-3 — fully dynamic simulated community" />

<style>
:root {
  --bg: #0f1724;
  --card: #0b1220;
  --muted: #9aa4b2;
  --accent: #3b82f6;
  --hover: rgba(63,132,246,0.1);
  --scrollbar: rgba(63,132,246,0.3);
}
html, body {
  margin: 0;
  height: 100%;
  font-family: Inter, system-ui, sans-serif;
  background: var(--bg);
  color: #e6eef6;
}

/* App shell */
.app-root {
  display: flex;
  height: 100vh;
  width: 100vw;
  gap: 12px;
  overflow: hidden;
}

/* Sidebar */
.sidebar {
  width: 320px;
  flex-shrink: 0;
  background: #071029;
  display: flex;
  flex-direction: column;
  padding: 16px;
  gap: 8px;
  overflow-y: auto;
}
.sidebar::-webkit-scrollbar { width: 6px; }
.sidebar::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 3px; }

/* Header / Logo + Community + Members */
.logo-row { display:flex; align-items:center; gap:10px; position:relative; }
.logo { width:42px; height:42px; }
.community-name { font-size:18px; font-weight:500; color:#cfe8ff; flex:1; }
.members-btn { margin-left:auto; background:transparent; border:none; cursor:pointer; color:#cfe8ff; padding:4px; transition:all .2s; }
.members-btn:hover { background:var(--hover); border-radius:6px; }

/* Private Group row */
.private-row { display:flex; align-items:center; gap:6px; margin-left:52px; font-size:13px; color:var(--muted); margin-top:4px; }

/* Separator line */
.header-separator { border:0; border-bottom:1px solid rgba(255,255,255,0.1); margin:6px 0; }

/* Live Info row (dynamic) */
.live-info { font-size:12px; color:#cfe8ff; margin-left:52px; margin-bottom:4px; }

/* System / Group Message row */
.system-info { font-size:12px; color:var(--muted); margin-left:52px; margin-bottom:6px; font-style:italic; }

/* Members Panel */
#membersPanel { display:none; flex-direction:column; gap:6px; background:#071226; padding:12px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.4); transition:all .2s; margin-top:6px; }
#membersPanel .close-btn { display:flex; justify-content:flex-end; }
#membersPanel input { padding:8px; border-radius:6px; border:1px solid rgba(255,255,255,0.02); background:#051226; color:#e6eef6; transition:all .2s; }
#membersPanel input:focus { outline:none; border-color:var(--accent); box-shadow:0 0 5px var(--accent); background:#051433; }

/* Main chat */
.main { flex:1; display:flex; flex-direction:column; background: linear-gradient(180deg,#071124,#02101b); overflow:hidden; }
.chat-container { flex:1; overflow-y:auto; padding:16px; }
.chat-container::-webkit-scrollbar { width:6px; }
.chat-container::-webkit-scrollbar-thumb { background:var(--scrollbar); border-radius:3px; }
#chat { display:flex; flex-direction:column; gap:8px; max-width:800px; margin:0 auto; }
.reply-preview { padding:8px 12px; background:#07192a; color:#d3e8ff; border-top:1px solid rgba(255,255,255,0.02); border-radius:6px; }
#typingRow { padding:8px 16px; color:var(--muted); font-size:0.9rem; }

/* Composer/footer */
.composer { display:flex; align-items:center; padding:12px; border-top:1px solid rgba(255,255,255,0.02); gap:8px; background:var(--card); }
.composer input#messageInput { flex:1; padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:#071833; color:#e6eef6; transition:all .2s; }
.composer input#messageInput:focus { outline:none; border-color:var(--accent); box-shadow:0 0 5px var(--accent); }
button { background:transparent; border:none; color:#cfe8ff; padding:8px; cursor:pointer; transition:all .2s; }
button:hover { background:var(--hover); border-radius:6px; }

/* Fingerprint logs (hidden) */
#fpLogs { position:fixed; bottom:10px; right:10px; width:300px; height:150px; overflow:auto; background:#071124; color:#cfe8ff; padding:10px; font-size:12px; border:1px solid #0b1220; z-index:999; display:none; }
</style>

<script src="https://cdn.jsdelivr.net/npm/lucide@0.263.0/dist/lucide.min.js"></script>
</head>
<body>

<div id="app" class="app-root">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo-row">
      <img src="./assets/logo.png" alt="logo" class="logo">
      <div class="community-name">Abrox Bots Community</div>
      <button id="membersToggle" class="members-btn"><i data-lucide="users"></i></button>
    </div>

    <div class="private-row">
      <i data-lucide="lock"></i>
      <span>Private Group</span>
    </div>

    <hr class="header-separator">

    <div class="live-info" id="liveInfo" hidden>
      Online: <span id="onlineCount">0</span> |
      Typing: <span id="typingName">—</span> |
      Verified: <span id="verifiedCount">0</span>
    </div>

    <div class="system-info" id="systemInfo" hidden>
      Verification required to participate in this group.
    </div>

    <div id="membersPanel">
      <div class="close-btn">
        <button id="membersClose"><i data-lucide="x"></i></button>
      </div>
      <input id="membersSearch" placeholder="Search members">
      <div id="membersList" aria-live="polite" role="list"></div>
    </div>
  </aside>

  <!-- Main Chat -->
  <main class="main">
    <section class="chat-container">
      <div id="chat"></div>
    </section>

    <div id="replyPreviewContainer" class="reply-preview" hidden></div>

    <footer class="composer">
      <div style="display:flex;gap:6px;align-items:center;">
        <button id="emojiBtn"><i data-lucide="smile"></i></button>
        <button id="mediaBtn"><i data-lucide="paperclip"></i></button>
        <input id="fileInput" type="file" style="display:none">
        <button id="micBtn"><i data-lucide="mic"></i></button>
      </div>
      <div style="flex:1;margin:0 8px;">
        <input id="messageInput" placeholder="Message @community">
      </div>
      <div style="display:flex;gap:6px;align-items:center">
        <button id="sendBtn">Send</button>
      </div>
    </footer>

    <div id="typingRow" hidden></div>
  </main>
</div>

<pre id="fpLogs"></pre>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  if(window.lucide) lucide.createIcons();

  // Members Panel toggle
  const membersToggle = document.getElementById('membersToggle');
  const membersPanel = document.getElementById('membersPanel');
  const membersClose = document.getElementById('membersClose');

  membersToggle.addEventListener('click', ()=> { membersPanel.style.display = 'flex'; });
  membersClose.addEventListener('click', ()=> { membersPanel.style.display = 'none'; });

  // Load scripts sequentially (order matters)
  const scripts = [
    './js/fingerprint-db.js',
    './js/icons.js',
    './js/members-pool.js',
    './js/synthetic-people.js',
    './js/message-pool.js',
    './js/message.js',
    './js/ui-adapter.js',
    './js/presence-manager.js',
    './js/typing-engine.js',
    './js/simulation-engine.js',
    './js/moderated-qa.js',
    './js/precache.js'
  ];

  for(const src of scripts){
    await new Promise((res, rej)=>{
      const s = document.createElement('script');
      s.src = src;
      s.onload = res;
      s.onerror = ()=>rej(new Error('Failed to load ' + src));
      document.body.appendChild(s);
    }).catch(err => console.error(err));
  }

  if(window.FingerprintDB) await FingerprintDB.init();

  if(window._abrox && window._abrox.onModulesReady){
    window._abrox.onModulesReady(['MessagePool','SyntheticPeople','Message'], function(){
      if(window.uiAdapter && typeof window.uiAdapter.prefill === 'function'){
        uiAdapter.prefill();
      }
    });
  }

  if(window.SimulationEngine && typeof window.SimulationEngine.start === 'function'){
    SimulationEngine.start();
  }

  // Example: populate Live Info dynamically (will be updated by PresenceManager)
  const liveInfo = document.getElementById('liveInfo');
  liveInfo.hidden = false;
  document.getElementById('onlineCount').textContent = 12;
  document.getElementById('typingName').textContent = 'Alex';
  document.getElementById('verifiedCount').textContent = 5;

  const systemInfo = document.getElementById('systemInfo');
  systemInfo.hidden = false;
});
</script>

</body>
</html>
